<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nug Catcher</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: yellow;
      font-family: Arial, sans-serif;
    }
    #scoreboard, #highscore {
      position: absolute;
      font-size: 20px;
      font-weight: bold;
      z-index: 2;
    }
    #scoreboard {
      top: 10px;
      left: 10px;
    }
    #highscore {
      top: 10px;
      right: 10px;
    }
    #mute-toggle {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      font-size: 16px;
      padding: 6px 12px;
    }
    #start-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 3;
      font-size: 24px;
      padding: 10px 20px;
      background-color: black;
      color: white;
      border: none;
      cursor: pointer;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>

  <div id="scoreboard">Score: 0</div>
  <div id="highscore">Highscore: 0</div>
  <button id="mute-toggle">ðŸ”‡ Mute</button>
  <button id="start-button">Start Game</button>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let score = 0;
    let highscore = localStorage.getItem("nugHighscore") || 0;
    document.getElementById("highscore").innerText = "Highscore: " + highscore;

    const panImg = new Image();
    panImg.src = "frying_pan.png";

    const nugImgs = [
      "nugs_og.png", "nugs_fed.png", "nugs_guitar.png",
      "nugs_lee.png", "nugs_sal.png", "nugs_shark.png",
      "nugs_sheikh.png", "nugs_thugga.png"
    ].map(src => {
      const img = new Image();
      img.src = src;
      return img;
    });

    const drugImgs = ["drug_1.png", "drug_2.png", "drug_3.png"].map(src => {
      const img = new Image();
      img.src = src;
      return img;
    });

    const positiveSound = new Audio("positive.wav");
    const negativeSound = new Audio("negative.wav");
    const panSound = new Audio("frying_pan_sound.wav");
    const themeSong = new Audio("Kahoot_Sound_Effect.wav");
    themeSong.loop = true;

    let isMuted = false;
    document.getElementById("mute-toggle").addEventListener("click", () => {
      isMuted = !isMuted;
      [positiveSound, negativeSound, panSound, themeSong].forEach(audio => {
        audio.muted = isMuted;
      });
      document.getElementById("mute-toggle").innerText = isMuted ? "ðŸ”Š Unmute" : "ðŸ”‡ Mute";
    });

    let pan = {
      x: canvas.width / 2 - 50,
      y: canvas.height - 100,
      width: 100,
      height: 50
    };

    let objects = [];
    let frame = 0;
    let misses = 0;
    let speedMultiplier = 1;
    let gameRunning = false;

    function spawnObject() {
      const isNugget = Math.random() < 0.7;
      const img = isNugget
        ? nugImgs[Math.floor(Math.random() * nugImgs.length)]
        : drugImgs[Math.floor(Math.random() * drugImgs.length)];
      const speed = Math.random() * 2 + 2 * speedMultiplier;
      objects.push({
        x: Math.random() * (canvas.width - 50),
        y: -50,
        img,
        isNugget,
        speed
      });
    }

    function drawPan() {
      if (panImg.complete && panImg.naturalWidth > 0) {
        ctx.drawImage(panImg, pan.x, pan.y, pan.width, pan.height);
      }
    }

    function drawObjects() {
      objects.forEach(obj => {
        if (obj.img.complete && obj.img.naturalWidth > 0) {
          ctx.drawImage(obj.img, obj.x, obj.y, 50, 50);
        }
      });
    }

    function updateObjects() {
      objects.forEach(obj => {
        obj.y += obj.speed;
      });

      objects = objects.filter(obj => {
        if (obj.y > canvas.height) return false;

        if (
          obj.y + 50 >= pan.y &&
          obj.x + 50 >= pan.x &&
          obj.x <= pan.x + pan.width
        ) {
          if (obj.isNugget) {
            score++;
            positiveSound.play();
          } else {
            misses++;
            negativeSound.play();
            if (misses >= 3) {
              alert("Game Over! Score: " + score);
              if (score > highscore) {
                localStorage.setItem("nugHighscore", score);
              }
              window.location.reload();
            }
          }
          return false;
        }
        return true;
      });
    }

    let mouseX = canvas.width / 2;
    document.addEventListener("mousemove", e => {
      mouseX = e.clientX;
    });

    function updatePanPosition() {
      pan.x += (mouseX - pan.x - pan.width / 2) * 0.2;
    }

    function gameLoop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      updatePanPosition();
      drawPan();
      drawObjects();
      updateObjects();
      document.getElementById("scoreboard").innerText = "Score: " + score;

      if (frame % Math.max(20 - speedMultiplier * 2, 5) === 0) spawnObject();
      if (frame % 600 === 0) speedMultiplier += 0.5;

      frame++;
      requestAnimationFrame(gameLoop);
    }

    function startGame() {
      document.getElementById("start-button").style.display = "none";
      panSound.play();
      themeSong.play();
      gameRunning = true;
      gameLoop();
    }

    document.getElementById("start-button").addEventListener("click", startGame);
  </script>
</body>
</html>
